import{d as e,am as t,ak as n,h as r,y as i,u as o,M as s,D as l,aa as a,an as c}from"./assets/index-BX9pONTp.js";import{x as d,a as w}from"./xterm-BkZOsaGq.js";import"./ace-Fk63Tb3T.js";const y=()=>{const y=e(null),{pyodide:h,isLoading:p,error:f}=t(),{colorMode:g}=n(),[m,u]=r(0),[k,b]=r(null),_={background:"dark"===g?"#2D3748":"white",foreground:"dark"===g?"#E2E8F0":"#2D3748",cursor:"dark"===g?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)",selectionBackground:"dark"===g?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"};return i((()=>{k&&(k.options.theme=_)}),[g]),i((()=>{if(!h||p||f)return;let e,t,n,r,i=[],o=-1,s="",l="",a=">>> ",c=null,g=0;const m=()=>{e.write("\r"),e.write(a+s),e.write("[K");const t=a.length+g,n=a.length+s.length-t;n>0&&e.write(`[${n}D`)},u=t=>{const{key:n,domEvent:r}=t,i=!r.altKey&&!r.ctrlKey&&!r.metaKey&&1===r.key.length;"Enter"===r.key?k():"Backspace"===r.key?x():"ArrowUp"===r.key?v("up"):"ArrowDown"===r.key?v("down"):"ArrowLeft"===r.key?g>0&&(g--,e.write("[D")):"ArrowRight"===r.key?g<s.length&&(g++,e.write("[C")):"Home"===r.key?(e.write(`[${g}D`),g=0):"End"===r.key?(e.write(`[${s.length-g}C`),g=s.length):"Tab"===r.key?C():r.ctrlKey&&"c"===r.key?E():i&&(s=s.slice(0,g)+n+s.slice(g),g++,m()),r.preventDefault()},k=async()=>{e.write("\r\n"),""!==(l+s).trim()&&i.push(l+s),o=i.length;const r=s;s="",g=0,e.options.disableStdin=!0;try{if(c=t.push(r+"\n"),"syntax-error"===c.syntax_check)e.writeln(c.formatted_error.trimEnd()),l="",a=">>> ",e.write(a),e.options.disableStdin=!1;else if("incomplete"===c.syntax_check)l+=r+"\n",a="... ",e.write(a),e.options.disableStdin=!1;else if("complete"===c.syntax_check){l+=r+"\n";try{const t=n(c),[r]=await t;if(void 0!==r){const t=h.runPython("repr(_)");e.writeln(t)}}catch(d){if("PythonError"===d.constructor.name){const t=c.formatted_error||d.message;e.writeln(t.trimEnd())}else e.writeln(`Error: ${d.message}`)}finally{c.destroy(),c=null}l="",a=">>> ",e.write(a),e.options.disableStdin=!1}}catch(d){e.writeln(`Error: ${d.message}`),l="",a=">>> ",e.write(a),e.options.disableStdin=!1}},E=()=>{if(s.length>0||l.length>0)s="",l="",g=0,e.write("^C\r\n"),a=">>> ",e.write(a),e.options.disableStdin=!1;else if(c&&!c.f_done)try{c.cancel(),h.runPython("\nimport sys\nimport _asyncio\n_asyncio.set_fatal_error_handler(lambda *args: None)\nraise KeyboardInterrupt\n"),e.write("^C\r\nExecution interrupted\r\n")}catch(t){}finally{c.destroy(),c=null,a=">>> ",e.write(a),e.options.disableStdin=!1}else e.write("^C\r\n"),a=">>> ",e.write(a),e.options.disableStdin=!1},x=()=>{g>0&&(s=s.slice(0,g-1)+s.slice(g),g--,m())},v=e=>{if("up"===e&&o>0){o--;const e=i[o];l="",a=">>> ",s=e,g=s.length,m()}else if("down"===e){if(o<i.length-1){o++;const e=i[o];l="",a=">>> ",s=e}else o=i.length,l="",a=">>> ",s="";g=s.length,m()}},C=()=>{const e=s.slice(0,g).match(/([a-zA-Z0-9_\.]+)$/);if(""===(e?e[1]:"")){const e="    ";s=s.slice(0,g)+e+s.slice(g),g+=e.length,m()}else D()},D=()=>{const n=s.slice(0,g),r=t.complete(n).toJs(),i=r[0],o=r[1];if(0===i.length);else if(1===i.length){const e=i[0].slice(o);s=s.slice(0,g)+e+s.slice(g),g+=e.length,m()}else if(i.length>1){e.write("\r\n"),e.writeln(i.join("  ")),e.write(a+s);const t=a.length+g,n=a.length+s.length;t<n&&e.write(`[${n-t}D`)}};return(async()=>{e=new d.Terminal({cursorBlink:!0,convertEol:!0,fontFamily:'"Fira Code", monospace',fontSize:14,theme:_}),b(e),r=new w.FitAddon,e.loadAddon(r),e.open(y.current),e.element.style.padding="16px",r.fit(),window.addEventListener("resize",r.fit),e.focus();const p=h.pyimport("pyodide.console"),{BANNER:f,PyodideConsole:m}=p;t=m(h.globals),n=h.runPython("\nimport builtins\nfrom pyodide.ffi import to_js\n\nasync def await_fut(fut):\n    try:\n        res = await fut\n        if res is not None:\n            builtins._ = res\n        return to_js([res], depth=1)\n    except KeyboardInterrupt:\n        return to_js([None], depth=1)\n\nawait_fut\n"),t.stdout_callback=t=>e.write(t.replace(/\n/g,"\r\n")),t.stderr_callback=t=>e.write(t.replace(/\n/g,"\r\n")),e.writeln(`Welcome to the Pyodide ${h.version} terminal emulator 🐍`),e.writeln(f),a=">>> ",i=[],o=-1,s="",l="",g=0,c=null,e.write(a),e.onKey(u)})(),()=>{e?.dispose(),window.removeEventListener("resize",r.fit)}}),[h,p,f,m]),o(s,{position:"relative",children:[o(s,{ref:y,style:{width:"100%",maxHeight:"350px"},bg:l("gray.900","gray.800"),borderRadius:"lg",overflow:"hidden"},m),o(a,{justifyContent:"center",mb:2,children:o(c,{mt:"2",size:"sm",onClick:()=>{u((e=>e+1))},children:"Clear"})})]})};export{y as default};
