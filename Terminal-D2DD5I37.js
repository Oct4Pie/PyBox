import{G as e,K as r,i as t,aj as n,h as o,y as a,u as i,a9 as s,am as c,a4 as d,v as l,an as u,ao as w,ap as h}from"./assets/index-DaUXl7r4.js";import{x as m,a as p}from"./xterm-BkZOsaGq.js";import{B as f}from"./heading-CJOt8PSV.js";import"./ace-Fk63Tb3T.js";function g(r){return e({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"4 17 10 11 4 5"},child:[]},{tag:"line",attr:{x1:"12",y1:"19",x2:"20",y2:"19"},child:[]}]})(r)}const b=new TextEncoder,x=()=>{const e=r(null),x=r(null),k=r(null),{sharedDir:v}=t(),{colorMode:y}=n(),[j,E]=o(null),[T,D]=o(null),[L,S]=o(!1),B={background:"dark"===y?"#2D3748":"white",foreground:"dark"===y?"#E2E8F0":"#2D3748",cursor:"dark"===y?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)",selectionBackground:"dark"===y?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.2)"};a((()=>{T&&(T.options.theme=B)}),[y]),a((()=>{if(!L)return;const r=()=>{k.current?.fit()};return(async()=>{try{await u({module:w,sdkUrl:`${window.location.href}/sdk/index.mjs`});const t=new m.Terminal({cursorBlink:!0,convertEol:!0,fontFamily:'"Fira Code", monospace',fontSize:13,theme:B});D(t);const n=new p.FitAddon;t.loadAddon(n),t.open(e.current),n.fit(),t.focus(),t.element.style.padding="16px";const o=await h.fromRegistry("sharrattj/bash"),a=await o.entrypoint.run({args:["-c",'echo "root:x:0:0:root:/root:/bin/bash" > /etc/passwd && echo "runner" > /etc/hostname && echo "127.0.0.1 runner" >> /etc/hosts && bash'],mount:{"/home":v},cwd:"/home",env:{HOME:"/home",PS1:"\\u@runner:\\w\\$ "}});F(a,t),E(a),x.current=t,k.current=n,window.addEventListener("resize",r)}catch(t){x.current?.writeln(`\r\n[31mError: ${t.message}[0m\r\n`)}})(),()=>{x.current?.dispose(),k.current?.dispose(),window.removeEventListener("resize",r)}}),[L,v]);const F=(e,r)=>{let t=e.stdin?.getWriter();r.onData((e=>{let n=r.buffer.active.getLine(r.buffer.active.cursorY)?.translateToString(!0).trim();n=n.replace(/^bash-\d+\.\d+#\s*/,""),"clear"===n?(r.clear(),t?.write(b.encode("")),t?.write(b.encode("\n"))):t?.write(b.encode(e))})),e.stdout.pipeTo(new WritableStream({write:e=>{const t=(new TextDecoder).decode(e);r.write(t)}})).catch((e=>{})),e.stderr.pipeTo(new WritableStream({write:e=>{const t=(new TextDecoder).decode(e);r.write(t)}})).catch((e=>{}))};return i(l,{children:L?i(f,{ref:e,style:{width:"100%",height:"350px",overflowY:"auto"},borderRadius:"lg",overflow:"clip"}):i(s,{direction:"row",w:"100%",h:"300px",align:"center",justify:"center",children:i(c,{onClick:()=>S(!0),children:[i(d,{as:g,mr:2}),"Load Terminal"]})})})};export{x as default};
